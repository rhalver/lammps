# -----------------------------
# Example script for self-propelled and self-aligning particles performing 2D collective motion using ellipsoids
# -----------------------------
variable NParticles equal 10000
variable Seed equal 12345
variable BoxSize equal 200

variable Diameter equal 0.62035		# Mass 1 for spheres and density=1
variable ActiveForce equal 4.0
variable SelfAlignment equal 0.1
variable RelaxTime equal 0.5 		# Relaxation time to terminal velocity for mass 1
variable Temperature equal 0.002
variable RotTempPrefactor equal 0.5

variable WCA_cut equal 1.122

# -----------------------------
# Generic Simulation parameters
# -----------------------------
units       lj
dimension   2
boundary    p p p
atom_style  ellipsoid

# -----------------------------
# Simulation box and atoms
# -----------------------------
region       box block 0 ${BoxSize} 0 ${BoxSize} -0.5 0.5
create_box   1 box
create_atoms 1 random ${NParticles} ${Seed} box

# -----------------------------
# Equilibration run to remove overlaps
# -----------------------------
pair_style      soft 1.122
pair_coeff      * * 0.0
variable        prefactor equal ramp(0,100) # strength of soft potential is increase slowly over time

fix             1 all brownian 0.0001 ${Seed} gamma_t 1.0
fix             2 all adapt 1 pair soft a * * v_prefactor
thermo		10000
run             50000
unfix		1
unfix           2

# -----------------------------
# Mass, dipole, velocities
# -----------------------------
velocity    all create 0.0 ${Seed} mom yes rot yes
set    	    type 1 shape ${Diameter} ${Diameter} ${Diameter}  # spheres
set         type 1 quat/random ${Seed}

# -----------------------------
# Interactions (WCA) - spherical
# -----------------------------
pair_style	lj/cut ${WCA_cut} 
pair_coeff	* * 1 1 ${WCA_cut}  # Cutoff LJ at minima to become WCA

# -----------------------------
# Individual dynamics
# -----------------------------
fix rotLangevin all langevin ${Temperature} ${Temperature} ${RelaxTime} ${Seed} angmom ${RotTempPrefactor}
fix active all propel/self quat ${ActiveForce}
fix align all propel/selfalign quat ${SelfAlignment}

# -----------------------------
# Integrators
# -----------------------------
fix nve_rot all nve/asphere
fix dipole2D all enforce2d # force z-components to zero every timestep

# -----------------------------
# Output
# -----------------------------
thermo      100
dump        1 all custom 100 collective_motion_quat.lammpstrj id type x y vx vy angmomx angmomy angmomz tqx tqy tqz

# -----------------------------
# Run
# -----------------------------
timestep    0.01
run         200000

